<!-- HTML for static distribution bundle build -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Swagger UI</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="@@folder@@assets/swagger-ui/swagger-ui.css" >
    <link rel="stylesheet" type="text/css" href="@@folder@@assets/swagger-ui/style.css">
    <link rel="stylesheet"  href="@@folder@@assets/css/clr-ui.min.css">
    <link rel="stylesheet"  href="@@folder@@assets/css/clr-icons.min.css">
    <link rel="icon" type="image/png" href="../swagger-ui/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../swagger-ui/favicon-16x16.png" sizes="16x16" />
    <style>
      html
      {
        box-sizing: border-box;
        overflow: -moz-scrollbars-vertical;
        overflow-y: scroll;
      }

      *,
      *:before,
      *:after
      {
        box-sizing: inherit;
      }

      body
      {
        margin:0 !important;
        background: #fafafa;
      }


</style>

  </head>

  <body>
    <div id="swagger-ui"></div>

    <!--<script src="../assets/swagger-ui/swagger-ui-bundle.js"> </script>
    <script src="../assets/swagger-ui/swagger-ui-standalone-preset.js"> </script>-->

    <script src="@@folder@@assets/swagger-ui/swagger-ui-bundle.js"> </script>
    <script src="@@folder@@assets/swagger-ui/swagger-ui-standalone-preset.js"> </script>
    <script src="@@folder@@assets/swagger-ui/jquery-1.8.0.min.js"> </script>
    <script src="@@folder@@assets/swagger-ui/jquery.sieve.min.js"></script>
    <script>

        (function($) {
            $.QueryString = (function(a) {
                if (a == "")
                    return {};
                var b = {};
                for (var i = 0; i < a.length; ++i) {
                    var p = a[i].split('=', 2);
                    if (p.length != 2)
                        continue;
                    b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
                }
                return b;
                
            })((window.location.hash || window.location.search).substr(1).split('&'))
        })(jQuery);

        $(function() {
            var qs = $.QueryString;
            // Add to the parent's hash, without triggering any "hashchange" event
            if (window.parent && window.parent.history.replaceState) {
                var hash = window.parent.document.location.hash;
                var split = hash.split("?");
                if (qs.useHash && qs.useHash == 'true') {
                    if (split.length > 1) {
                        var mhash = decodeURIComponent(split[1]).replace("path=", "");
                        var msplit = mhash.split("m=");
                        if (msplit.length > 1) {
                            window.location.hash = msplit[1];
                        } else {
                            window.location.hash = msplit[0];
                        }
                    } else if (split.length  == 1) {
                        window.location.hash = decodeURIComponent(split[0]);
                    }
                } else {
                    if (hash.length > 1) {
                        window.location.hash = decodeURIComponent(hash);
                    }
                }
                var parentUrl = window.parent.document.location.href;

                $(window).on("hashchange", function() {
                    if (!parentUrl.includes(window.location.hash)) {
                        if (qs.useHash && qs.useHash == 'true') {
                            window.parent.history.replaceState('', '', split[0] + "?m=" + decodeURIComponent(window.location.hash.substr(1)));
                        } else {
                            window.parent.history.replaceState('', '', window.parent.document.location.href.split('#')[0] + decodeURIComponent(window.location.hash));
                        }
                    }
                });
            }

            if (qs.url) {
                $.getJSON(qs.url, function(json) {

                    // Override "host"
                    if (qs.host && qs.host != "null") {
                        json.host = qs.host;
                    }

                    // Override "basePath"
                    if (qs.basePath && qs.basePath != "null") {
                        json.basePath = qs.basePath;
                    }

                    // Override "schemas"
                    if (qs.schemes && qs.schemes != 'undefined') {
                        json.schemes = [];
                        json.schemes.push(qs.schemes);
                    }

                    //get username and password
                    var user = sessionStorage.getItem('apix-user');
                    if (user)
                        user = JSON.parse(user);

                    var sso= sessionStorage.getItem('apix-sso');
                    if (sso)
                        sso = JSON.parse(sso);

                      if (user && sso) {
                        //basic authentication
                        if (sso.id == 'basic') {
                          var username = user.username;
                          var password = user.password;
                          if (username && password) {
                            var swaggerAuthName = sso.swaggerAuthName;
                            if (!swaggerAuthName) {
                              swaggerAuthName = "BasicAuth";
                            }
                          } else {
                            console.log("No basic auth credentials for swagger.");
                          }
                        } else {
                          //vRA and vCenter
                          var sessionId = sessionStorage.getItem('apix-session-id');
                            console.log("session id " + sessionId);
                            if (sessionId && sessionId.trim() != "") {
                                if (sso && sso.id == 'vra_sso') {
                                    ui.preauthorizeApiKey("apiKey", "acbde12345"); 
                                    var apiKeyAuth = new SwaggerClient.ApiKeyAuthorization("Authorization", "Bearer " + sessionId, "header");
                                    ui.api.clientAuthorizations.add("Authorization", apiKeyAuth);
                                } else if (sso && sso.id == 'vcenter_sso') {
                                    var apiKeyAuth = new SwaggerClient.ApiKeyAuthorization("vmware-api-session-id", sessionId, "header");
                                    ui.api.clientAuthorizations.add("vmware-api-session-id", apiKeyAuth);
                                    ui.preauthorizeApiKey("apiKey", "acbde12345"); 
                                }
                            }
                        }
                      }    
                      // Build a system
                      const ui = SwaggerUIBundle({
                            spec: json,
                            dom_id: '#swagger-ui',
                            supportedSubmitMethods : [ 'get', 'post', 'put', 'delete', 'patch' ],
                            deepLinking: true,
                            presets: [
                              SwaggerUIBundle.presets.apis,
                              SwaggerUIStandalonePreset
                            ],
                            plugins: [
                              SwaggerUIBundle.plugins.DownloadUrl,
                              HideTopbarPlugin
                            ],
                            docExpansion: "none",
                            layout: "StandaloneLayout",
                            //TODO: Authorization
                            /*requestInterceptor:
                              function (request) {
                                  console.log('[Swagger] intercept try-it-out request');            
                                  request.headers.Authorization = "Basic " + (username + ":" + password);
                                  return request;
                              },*/
                            onComplete: function () {
                                //ui.preauthorizeBasic ("basicAuth", username, password);

                                //remove the models section
                                $('.models').remove();

                                // Add the filter input
                                var template = "<br><div class='filter'><input type='text' class='form-control' placeholder='Filter Methods... '></div><br>";
                                $(".swagger-ui").find(".wrapper:eq(2)").sieve({
                                  itemSelector: "div",
                                  searchTemplate: template
                                });

                                // Reference to the created input field
                                var $filter = $(".filter");
                                var $input = $filter.find("input");

                                // Function that toggles all available operations
                                var toggleOperations = function () {
                                  var value = $input.val();
                                  if (value) {
                                    $(".swagger-ui .wrapper .opblock-tag-section a").click();
                                    //$(".opblock-tag-section").not(".is-open").click();
                                    //$(".swagger-ui").find(".wrapper .opblock-tag-section:not(.is-open)").click();
                                    //$('.expand-operation').click();
                                  } else {
                                    //$(".swagger-ui .opblock-tag-section .is-open").click();
                                  }
                            };

                            // When filtering, we first need to "expand" all the operations
                            $input.on("keyup change", toggleOperations);

                            // Hide swagger-ui "auth_container"
                            if (qs.hideApiInfo && qs.hideApiInfo == 'true') {
                                $("#auth_container").hide();
                                $("#api_info").hide();
                            }
                              },
                          onFailure : function(data) {
                            console.log("Unable to load SwaggerUI");
                        }
                      });
                            window.ui = ui;

                    /*hljs.configure({
                        highlightSizeThreshold : 5000
                    });*/

                }).fail(function(event, textStatus, error) {
                    $("#swagger-ui").empty().append("<p>Oops!  Request failed! The API documentation at " +  qs.url + " gives error: " + error + "</p>");
                })
            }
        });

    function HideTopbarPlugin() {
     // this plugin overrides the Topbar component to return nothing
      return {
        components: {
           Topbar: function() { return null },
           Wrapper: function() { return null}
        }
      }
    }
  </script>
  </body>
</html>
